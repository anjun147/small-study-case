# SpringSecurityOAuth2-demo

这个模块专门做的登录相关的测试，包括登录，授权操作。

# 一、后期期望的功能效果

- 系统间登录

两个服务之间相互登录，授权。因为有些功能需要提供接口给其他系统调用，这里就不用暴露`API`的方式，直接让第三方系统登录进来就可以操作了。

- 用户登录

手机端，当用户首次登录时，需要用户名、密码、安全码（校验码）登录。如果在同一个手机上`15`天内登录过的，那么提供用户名和密码就可以登录。`token`需要设置为有效期，如果用户`15`天没有来登录过，这个`token`就失效，如果`15`天内进入`APP`操作过，`token`继续有效。

- PC端

用户首次在电脑上登录，需要用户名、密码、安全码登录。如果`15`天内在这台电脑上登录过，用户名和密码就可以登录。`token`有效期为`30`分钟。



- 第三方登录

提供微信登录和QQ登录



- 登录数量

一个账号最多只能登录一个手机和一台电脑，如果在手机上登录了，在另一台手机上又登录。需要给当前登录的手机发送提示，是否下线或者拒绝对方登录。如果给出提示没有反应，那么需要在做校验，例如在他的个人信息中给出一些选项让他选择。如果你使用过哪些昵称，哪些头像等。

电脑就不用说了，反正只有30分钟的时间。正常情况下是不存在这种情况的，如果同时有一台电脑登录了，还有登录的消息，可以提示是否下线，如果没有反应，默认新登录的这台电脑不能登录。这个提示就给到电脑端，也可以发送到手机端。

- 登录相关提示

只要上面涉及到发送验证码登录的，登录成功或者失败都需要给用户发送短信给提示，可以提示更改密码之类的。短信中携带一个取消登录的网址，如果用户在手机上30分钟以内点击这个取消登录的网址，就将登录的`token`删除掉，并将这个账号加入高度紧急状态。

# 二、实现思路

当用户每次注册或者登录，我们都会将这台机器的相关设备信息保存到`MongoDB`中，有效期为`15`天。这个期限根据后期做决定，动态更改。每次用户到登录页面时，会将这个设备的信息发送给后端，做判断是否在这台设备上登录过。如果没有就使用安全码那种登录方式，安全码通过手机短信发送给客户。在这张表`MongoDB`文档中应该有登录时间，退出时间，还有一个状态值，是否在线。这样就很好的判断手机是否在线或者`PC`端是否在线的问题。



# 三、权限

权限全部做成颗粒度最细的那种，通过`URL`级别的那种对系统的确有些负担，也没有必要做成那种形式。菜单级别的和`URL`级别的需要混合制作。并且这些权限设置为动态的，代码中不要涉及任何相关权限的代码。无侵入式的，所以就要靠数据库了，建议使用`MongoDB`在制作，但是这些数据需要在程序中做缓存。是在程序中做换成，不是换成到`Redis`，相当于将这些数据放在`List`或者`Map`这样的集合中。因为`Redis`速度再快，也会涉及到网路传输的问题，但是访问路径这个是十分快速的东西，所以就没有必要做缓存。



